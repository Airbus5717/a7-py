<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A7 Pipeline Reference</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@500;600;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#f1fcf8; --surface:#ffffff; --surface2:#e8faf3; --text:#17342b; --text-dim:#4f7b6e;
      --border:rgba(12,63,50,.14); --accent:#0f7b66; --accent-dim:rgba(15,123,102,.12);
      --blue:#196baf; --amber:#ba7318; --rose:#b2425e;
      --font:'Bricolage Grotesque',system-ui,sans-serif; --mono:'IBM Plex Mono',ui-monospace,monospace;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg:#0f1d1a; --surface:#152824; --surface2:#1a312c; --text:#e8f7f1; --text-dim:#9bc6b7;
        --border:rgba(186,230,214,.2); --accent:#65d0b2; --accent-dim:rgba(101,208,178,.16);
        --blue:#82c8ff; --amber:#ffcd8d; --rose:#f3a0b5;
      }
    }
    *{box-sizing:border-box} body{margin:0;padding:40px;background:
      radial-gradient(900px 360px at 10% -8%, var(--accent-dim), transparent 60%),
      radial-gradient(860px 360px at 92% 0%, rgba(186,115,24,.16), transparent 58%), var(--bg);
      color:var(--text); font-family:var(--font); font-size:18px; line-height:1.6;}
    .wrap{max-width:1100px;margin:0 auto}
    h1{margin:0;font-size:clamp(2.4rem,4.8vw,3.6rem);line-height:1.02;letter-spacing:-.02em}
    .sub{margin:.75rem 0 1.5rem;color:var(--text-dim);font-family:var(--mono);font-size:14px}
    .panel{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:20px}
    .legend{display:flex;gap:12px;flex-wrap:wrap;margin:0 0 10px}
    .legend span{font-family:var(--mono);font-size:13px;color:var(--text-dim);display:flex;align-items:center;gap:6px}
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block}
    .dot-a{background:var(--accent)} .dot-b{background:var(--blue)} .dot-c{background:var(--amber)} .dot-d{background:var(--rose)}
    .mermaid-wrap{position:relative;border:1px solid var(--border);border-radius:14px;background:var(--surface2);padding:34px 20px 22px;overflow:auto}
    .mermaid-wrap .mermaid{display:flex;justify-content:center;transition:transform .2s ease;transform-origin:top center;min-width:740px}
    .zoom{position:absolute;top:8px;right:8px;display:flex;gap:2px;padding:2px;background:var(--surface);border:1px solid var(--border);border-radius:8px;z-index:8}
    .zoom button{width:28px;height:28px;border:0;border-radius:6px;background:transparent;color:var(--text-dim);font-family:var(--mono);cursor:pointer}
    .zoom button:hover{background:var(--accent-dim);color:var(--text)}
    .mermaid-wrap.is-zoomed{cursor:grab}.mermaid-wrap.is-panning{cursor:grabbing;user-select:none}
    .mermaid .nodeLabel{font-family:var(--font)!important;font-size:18px!important;color:var(--text)!important}
    .mermaid .edgeLabel{font-family:var(--mono)!important;font-size:14px!important;color:var(--text-dim)!important}
    .mermaid .edgeLabel rect{fill:var(--bg)!important}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>A7 Pipeline Reference</h1>
    <p class="sub">Compiler stage map with semantic passes and output artifacts.</p>
    <section class="panel">
      <div class="legend">
        <span><i class="dot dot-a"></i>Frontend parsing</span>
        <span><i class="dot dot-b"></i>Semantic analysis</span>
        <span><i class="dot dot-c"></i>Preprocess/codegen</span>
        <span><i class="dot dot-d"></i>Artifacts</span>
      </div>
      <div class="mermaid-wrap" id="m1">
        <div class="zoom"><button data-z="in">+</button><button data-z="out">−</button><button data-z="reset">↺</button></div>
        <pre class="mermaid">
graph LR
  SRC["source .a7"] --> TOK["tokenizer"] --> PAR["parser"] --> AST["AST"]
  AST --> NR["name resolution"] --> TC["type checker"] --> SV["semantic validator"]
  SV --> AP["AST preprocessor"] --> ZIG["zig backend"]
  ZIG --> OUT[".zig output"]
  AP -. doc mode .-> DOC["markdown report"]
  TOK -. mode .-> MT["tokens output"]
  PAR -. mode .-> MA["AST output"]
  SV -. mode .-> MS["semantic report"]

  classDef a fill:#0f7b6624,stroke:#0f7b66,stroke-width:1.5px
  classDef b fill:#196baf24,stroke:#196baf,stroke-width:1.5px
  classDef c fill:#ba731824,stroke:#ba7318,stroke-width:1.5px
  classDef d fill:#b2425e24,stroke:#b2425e,stroke-width:1.5px

  class SRC,TOK,PAR,AST a
  class NR,TC,SV b
  class AP,ZIG c
  class OUT,DOC,MT,MA,MS d
        </pre>
      </div>
    </section>
  </div>
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
    import elkLayouts from 'https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk/dist/mermaid-layout-elk.esm.min.mjs';
    mermaid.registerLayoutLoaders(elkLayouts);
    const dark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    mermaid.initialize({ startOnLoad:true, theme:'base', layout:'elk', look:'classic', themeVariables:{
      primaryColor: dark ? '#1a312c' : '#e8faf3', primaryBorderColor: dark ? '#65d0b2' : '#0f7b66', primaryTextColor: dark ? '#e8f7f1' : '#17342b',
      secondaryColor: dark ? '#1d2f43' : '#e7f2ff', secondaryBorderColor: dark ? '#82c8ff' : '#196baf', secondaryTextColor: dark ? '#e8f7f1' : '#17342b',
      tertiaryColor: dark ? '#362b1f' : '#fff2df', tertiaryBorderColor: dark ? '#ffcd8d' : '#ba7318', tertiaryTextColor: dark ? '#e8f7f1' : '#17342b',
      lineColor: dark ? '#89b7a9' : '#4f7b6e', fontSize:'15px', fontFamily:'Bricolage Grotesque'
    }});
    const wrap=document.getElementById('m1'); const mer=wrap.querySelector('.mermaid'); const zoom=wrap.querySelector('.zoom');
    let s=1.18, p=false, sx=0, sy=0, sl=0, st=0;
    const apply=()=>{mer.style.transform=`scale(${s})`; wrap.classList.toggle('is-zoomed', s>1.01)};
    zoom.addEventListener('click',(e)=>{const b=e.target.closest('button'); if(!b)return; const z=b.dataset.z; if(z==='in')s=Math.min(3,s+.14); if(z==='out')s=Math.max(.7,s-.14); if(z==='reset')s=1; apply();});
    wrap.addEventListener('wheel',(e)=>{if(!(e.ctrlKey||e.metaKey))return; e.preventDefault(); s += e.deltaY<0?.08:-.08; s=Math.max(.7,Math.min(3,s)); apply();},{passive:false});
    wrap.addEventListener('mousedown',(e)=>{if(s<=1.01||e.button!==0)return; p=true; wrap.classList.add('is-panning'); sx=e.pageX-wrap.offsetLeft; sy=e.pageY-wrap.offsetTop; sl=wrap.scrollLeft; st=wrap.scrollTop;});
    window.addEventListener('mouseup',()=>{p=false; wrap.classList.remove('is-panning');});
    wrap.addEventListener('mousemove',(e)=>{if(!p)return; e.preventDefault(); const x=e.pageX-wrap.offsetLeft; const y=e.pageY-wrap.offsetTop; wrap.scrollLeft=sl-(x-sx); wrap.scrollTop=st-(y-sy);});
    apply();
  </script>
</body>
</html>
